---
import Layout from '../layouts/Layout.astro';
---

<Layout title="API Test">
  <div style="padding: 20px;">
    <h1>API Test Page</h1>
    <button id="testApi">Test API Call</button>
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f5f5f5; white-space: pre-wrap;"></div>
  </div>

  <script>
    document.getElementById('testApi').addEventListener('click', async () => {
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = 'Loading...';
      
      try {
        // Import logger for test page
        const { getLogger } = await import('../utils/logger.ts');
        const logger = getLogger('test-api');
        
        logger.info('Testing API call');
        const API_BASE_URL = import.meta.env.PUBLIC_API_URL || 'https://2t9blvt2c1.execute-api.us-east-1.amazonaws.com/prod';
        const response = await fetch(`${API_BASE_URL}/v2/projects`, {
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        logger.debug('API test response', { 
          status: response.status, 
          ok: response.ok,
          // WARNING: This test page logs full response data - do not use with sensitive endpoints
          data 
        });
        
        resultDiv.textContent = `Status: ${response.status}\nData: ${JSON.stringify(data, null, 2)}`;
      } catch (error) {
        // Import logger for error handling
        const { getLogger } = await import('../utils/logger.ts');
        const logger = getLogger('test-api');
        logger.error('API test error', {}, error);
        resultDiv.textContent = `Error: ${error.message}`;
      }
    });
  </script>
</Layout>
