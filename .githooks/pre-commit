#!/bin/bash

# Pre-commit hook for registry-frontend
# Runs formatting and linting checks before allowing commits

set -e

echo "ğŸ” Running pre-commit validation..."

# Get list of staged TypeScript/JavaScript files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

if [ -z "$STAGED_FILES" ]; then
    echo "âœ… No TypeScript/JavaScript files to check"
    exit 0
fi

echo "ğŸ“ Formatting staged files with Prettier..."
for FILE in $STAGED_FILES; do
    if [ -f "$FILE" ]; then
        echo "  ğŸ“ Formatting: $FILE"
        npx prettier --write "$FILE"
        git add "$FILE"
    fi
done

echo "ğŸ” Running ESLint on staged files..."
for FILE in $STAGED_FILES; do
    if [ -f "$FILE" ]; then
        npx eslint "$FILE" || {
            echo "âŒ ESLint failed for $FILE"
            exit 1
        }
    fi
done

echo "âœ… Pre-commit validation passed!"
echo "ğŸ“Š Completed checks:"
echo "   âœ… Code formatting (prettier) - auto-applied"
echo "   âœ… Code linting (eslint)"

exit 0
