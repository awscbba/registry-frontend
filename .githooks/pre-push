#!/bin/bash

# Pre-push hook for registry-frontend
# Runs tests and type checking before allowing pushes

set -e

echo "ğŸ” Running pre-push validation..."

# Run type checking using the project's TypeScript
echo "ğŸ” Running TypeScript type checking..."
if command -v npm &> /dev/null; then
    npm run type-check || {
        echo "âŒ TypeScript type checking failed"
        echo "ğŸ’¡ Fix type errors before pushing"
        echo "ğŸ’¡ Or run: git push --no-verify (not recommended)"
        exit 1
    }
else
    echo "âš ï¸  npm not found, skipping type check"
fi

# Run tests
echo "ğŸ§ª Running tests..."
if command -v npm &> /dev/null; then
    npm run test || {
        echo "âŒ Tests failed"
        echo "ğŸ’¡ Fix failing tests before pushing"
        echo "ğŸ’¡ Or run: git push --no-verify (not recommended)"
        exit 1
    }
else
    echo "âš ï¸  npm not found, skipping tests"
fi

echo "âœ… Pre-push validation passed!"
echo "ğŸ“Š Completed checks:"
echo "   âœ… TypeScript type checking"
echo "   âœ… Tests"

exit 0
